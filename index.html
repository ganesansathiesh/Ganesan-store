<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GANESAN STORE</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial; display: flex; }
    .left { width: 30%; padding: 20px; background: #f0f0f0; }
    .right { width: 70%; padding: 20px; }
    button { margin: 5px; padding: 10px; }
    .image-box { border: 2px dashed gray; width: 100%; height: 100px; margin: 5px 0; position: relative; text-align: center; }
    .image-box img { max-height: 100px; }
    input { width: 130px; margin: 5px; }
    textarea { width: 100%; margin-top: 10px; font-size: 12px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    td, th { border: 1px solid #000; text-align: center; height: 25px; }
    th { background: #eee; }
  </style>
</head>
<body>
  <div class="left">
    <h1>GANESAN STORE</h1>
    <div>
      <button onclick="selectCol(1)">1</button>
      <button onclick="selectCol(3)">3</button>
      <button onclick="selectCol(5)">5</button>
      <button onclick="selectCol(15)">15</button>
    </div>
    <div>
      <button onclick="setEven()">EVEN</button>
      <button onclick="setUneven()">UNEVEN</button>
    </div>

    <h3>Paste Image Below</h3>

    <div id="greenBox" class="image-box" onpaste="handlePaste(event, 'GREEN')">Paste GREEN image here<br>(Ctrl+V)</div>
    <input id="GREENOpen" placeholder="GREEN Open">
    <input id="GREENHigh" placeholder="GREEN High">
    <input id="GREENLow" placeholder="GREEN Low">
    <input id="GREENClose" placeholder="GREEN Close">

    <div id="redBox" class="image-box" onpaste="handlePaste(event, 'RED')">Paste RED image here<br>(Ctrl+V)</div>
    <input id="REDOpen" placeholder="RED Open">
    <input id="REDHigh" placeholder="RED High">
    <input id="REDLow" placeholder="RED Low">
    <input id="REDClose" placeholder="RED Close">

    <button onclick="compare()">COMPARE</button>
    <textarea id="ocrOutput" rows="4" placeholder="OCR debug output here..."></textarea>
  </div>

  <div class="right">
    <table>
      <tr><th>1</th><th>3</th><th>5</th><th>15</th></tr>
      <!-- 20 rows -->
      <script>
        for (let i = 0; i < 20; i++) {
          document.write('<tr><td></td><td></td><td></td><td></td></tr>');
        }
      </script>
    </table>
  </div>

  <script>
    function handlePaste(event, type) {
      event.preventDefault();
      const items = event.clipboardData.items;
      for (const item of items) {
        if (item.type.indexOf("image") !== -1) {
          const blob = item.getAsFile();
          const reader = new FileReader();
          reader.onload = function(evt) {
            const base64 = evt.target.result;
            document.getElementById(type.toLowerCase() + "Box").innerHTML = `<img src="${base64}">`;
            runOCR(base64, type);
          };
          reader.readAsDataURL(blob);
        }
      }
    }

    function runOCR(imageSrc, type) {
      Tesseract.recognize(imageSrc, 'eng').then(({ data: { text } }) => {
        document.getElementById("ocrOutput").value = text;

        const cleaned = text.replace(/[^A-Za-z\d.,:\n\s]/g, '');
        const numbers = cleaned.match(/\d{2,3}[,\.]\d{3}[,\.]?\d{0,2}/g);

        if (numbers && numbers.length >= 4) {
          document.getElementById(type + "Open").value = numbers[0];
          document.getElementById(type + "High").value = numbers[1];
          document.getElementById(type + "Low").value = numbers[2];
          document.getElementById(type + "Close").value = numbers[3];
        } else {
          const lower = text.toLowerCase();
          const extractValue = (label) => {
            const match = new RegExp(label + '[:\\s]*([\\d,\\.]+)', 'i').exec(lower);
            return match ? match[1] : '';
          };

          const open = extractValue("open");
          const high = extractValue("high");
          const low = extractValue("low");
          const close = extractValue("close");

          if (open && high && low && close) {
            document.getElementById(type + "Open").value = open;
            document.getElementById(type + "High").value = high;
            document.getElementById(type + "Low").value = low;
            document.getElementById(type + "Close").value = close;
          } else {
            alert("Could not extract all OHLC values from image.");
          }
        }
      });
    }

    function compare() {
      const gClose = parseFloat(document.getElementById("GREENClose").value.replace(/,/g, ''));
      const rOpen = parseFloat(document.getElementById("REDOpen").value.replace(/,/g, ''));
      const gHigh = parseFloat(document.getElementById("GREENHigh").value.replace(/,/g, ''));
      if (gClose > rOpen && rOpen > gHigh) {
        alert("U");
      } else {
        alert("N");
      }
    }

    function selectCol(col) {
      alert("Selected column: " + col);
    }

    function setEven() {
      alert("Even selected");
    }

    function setUneven() {
      alert("Uneven selected");
    }
  </script>
</body>
</html>
